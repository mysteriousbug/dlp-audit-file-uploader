import json
import pandas as pd

# Load your real 17k-row file
df = pd.read_excel("input.xlsx")   # or read_csv

def extract_dev_stg(ip_dict):
    """Extract key-value pairs where Environment is DEV or STG."""
    if not isinstance(ip_dict, dict):
        return None
    
    result = {}
    for ip, meta in ip_dict.items():
        env = meta.get("Environment", "").upper()

        if "DEV" in env or "STG" in env or "STAGE" in env:
            result[ip] = meta

    return result if result else None

# Apply extraction for both columns
df["source_ip"] = df["Source IP/Subnet"].apply(extract_dev_stg)
df["destination_ip"] = df["Destination IP/Subnet"].apply(extract_dev_stg)

# Save final output
df.to_excel("output_dev_stg_only.xlsx", index=False)

print("Extraction complete. Saved to output_dev_stg_only.xlsx")
